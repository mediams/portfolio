name: Keep Render App Awake

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch: {}

permissions:
  contents: read

concurrency:
  group: keep-render-awake
  cancel-in-progress: true

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: Ping health (preferred)
        run: |
          URL="https://onlineshopgarden.onrender.com/actuator/health"
          for i in 1 2 3; do
            echo "Attempt $i: $URL"
            if curl -sSfL --max-time 20 -A "keepalive-bot/1.0" "$URL" -o /dev/null; then
              echo "OK"
              exit 0
            fi
            echo "Failed, sleep 10s..."
            sleep 10
          done
          echo "All attempts failed"
          exit 1

      - name: (Optional) Ping products (heavier)
        if: always()
        run: |
          URL="https://onlineshopgarden.onrender.com/api/products/all"
          curl -sS -L --max-time 25 -A "keepalive-bot/1.0" "$URL" -o /dev/null || true
